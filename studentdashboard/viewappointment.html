<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>My History â€” PUP Taguig Clinic</title>
    <style>
      /* --- SHARED STYLES & VARIABLES (From booking.html) --- */
      :root{
        --accent:#ff5a4d;
        --muted:#f3f6f5;
        --text:#222;
        --card-bg:#ffffff;
        --max-width:1100px;
      }
      *{box-sizing:border-box}
      html,body{height:100%}
      body{
        margin:0;
        font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial;
        color:var(--text);
        background: #fff;
      }
      .container{max-width:var(--max-width);margin:0 auto;padding:0 20px}

      /* --- HEADER STYLES --- */
      .site-header{background:#fff;position:sticky;top:0;z-index:60;box-shadow:0 6px 20px rgba(16,24,28,0.06)}
      .header-inner{display:flex;align-items:center;justify-content:space-between;padding:12px 0;gap:16px}
      
      .brand-link{display:flex;align-items:center;gap:12px;text-decoration:none}
      .brand-img{width:48px;height:48px;object-fit:cover;border-radius:50%}
      .brand-text{display:flex;flex-direction:column;line-height:1}
      .brand-title{font-weight:900;font-size:18px;letter-spacing:0.6px;background:linear-gradient(90deg,var(--accent),#ff8b6f);-webkit-background-clip:text;background-clip:text;color:transparent}
      .brand-subtitle{font-size:11px;color:#6b7b7d;font-weight:700;text-transform:uppercase;letter-spacing:1px;margin-top:2px}

      .nav-toggle{display:none;background:transparent;border:0;padding:8px;border-radius:8px;cursor:pointer}
      .main-nav{display:flex;align-items:center;gap:18px}
      .nav-list{display:flex;gap:18px;list-style:none;margin:0;padding:0}
      .nav-list a{color:#2f454b;text-decoration:none;padding:10px 6px;border-radius:6px;display:inline-block;font-size:14px;font-weight:500}
      .nav-list a:hover,.nav-list a:focus{background:rgba(15,27,38,0.04);color:#15222a}

     

      @media (max-width:900px){
        .nav-list{display:none;flex-direction:column;background:#fff;position:absolute;left:0;right:0;top:72px;padding:14px 20px;border-bottom:1px solid rgba(0,0,0,0.06);box-shadow:0 10px 20px rgba(0,0,0,0.05)}
        .nav-list.show{display:flex}
        .nav-toggle{display:inline-flex}
        .brand-text{display:none}
      }

      /* --- PAGE SPECIFIC STYLES --- */
      main.container { padding-top: 20px; padding-bottom: 40px; }
      
      .page-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
      h1 { margin: 0; }
      
      /* Full width card for history */
      .card{background:var(--card-bg);padding:24px;border-radius:12px;box-shadow:0 8px 26px rgba(16,24,28,0.06); min-height: 400px;}
      
      .btn{padding:10px 14px;border-radius:8px;font-weight:700;border:0;background:var(--accent);color:#fff;text-decoration:none;cursor:pointer;font-size:14px; display:inline-block;}
      .btn-outline { border: 1px solid var(--accent); color: var(--accent); background: transparent; padding: 8px 14px; border-radius: 8px; text-decoration: none; font-weight: 600; font-size: 14px; }
      
      /* History List Grid */
      .history-grid { display: grid; gap: 16px; margin-top: 20px; }
      
      .apt-card{padding:16px;border-radius:10px;background:#fff;border:1px solid #eef2f3;display:flex;flex-direction:column;gap:10px; transition: box-shadow 0.2s; }
      .apt-card:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.05); border-color: #e0e6e8; }
      
      .apt-header { display: flex; justify-content: space-between; align-items: flex-start; }
      .apt-service { font-size: 16px; font-weight: 700; color: #20343a; }
      .apt-date { font-weight: 600; color: var(--accent); }
      
      .apt-details { display: flex; gap: 20px; color: #5f7174; font-size: 14px; margin-top: 4px; }
      .apt-notes { background: var(--muted); padding: 10px; border-radius: 6px; font-size: 14px; color: #445; margin-top: 4px; }
      
      .status-badge { display: inline-block; padding: 4px 8px; border-radius: 4px; background: #e6f7e6; color: #2d7a31; font-size: 12px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; }
      
      .empty-state { text-align: center; padding: 40px; color: #889; }
    </style>
  </head>
  <body>
    
    <header class="site-header">
      <div class="container header-inner">
        <div class="header-left">
          <a class="brand-link" href="bookapp.html">
            <img src="pup_logo.png" alt="PUP Taguig" class="brand-img" />
            <span class="brand-text">
              <span class="brand-title">PUP TAGUIG</span>
              <span class="brand-subtitle">Online Clinic</span>
            </span>
          </a>
        </div>

        <button class="nav-toggle" aria-controls="main-menu" aria-expanded="false" aria-label="Open menu">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18M3 12h18M3 18h18" stroke="#20343A" stroke-width="2" stroke-linecap="round"/></svg>
        </button>

        <nav id="main-menu" class="main-nav" role="navigation">
          <ul class="nav-list">
            <li><a href="homepage_student.html">Home</a></li>
            <li><a href="booking.html">Appointments</a></li>
            <li><a href="Userbookinghistory.html">My Account</a></li>
          </ul>
        </nav>

     
    </header>

    <main class="container">
      <div class="page-header">
        <div>
          <h1>Appointment History</h1>
          <p class="small" style="color:#6b7b7d; margin-top:4px">View and manage your past and upcoming consultations.</p>
        </div>

      </div>

      <section class="card">
        <div id="historyList" class="history-grid" aria-live="polite">
          </div>
        
        <div id="emptyMsg" class="empty-state" style="display:none">
          <p>You have no appointment history.</p>
          <a href="booking.html" class="btn-outline">Book your first appointment</a>
        </div>
      </section>
    </main>

<script>
  (function(){
    // Nav toggle logic
    const navBtn = document.querySelector('.nav-toggle');
    const navMenu = document.querySelector('.nav-list');
    if(navBtn && navMenu){
      navBtn.addEventListener('click', function(){
        const expanded = this.getAttribute('aria-expanded') === 'true';
        this.setAttribute('aria-expanded', String(!expanded));
        navMenu.classList.toggle('show');
      });
    }

    // Data logic
    const KEY = 'pup_appointments_v1';
    const listEl = document.getElementById('historyList');
    const emptyMsg = document.getElementById('emptyMsg');

    function getAppointments(){ try{return JSON.parse(localStorage.getItem(KEY) || '[]')}catch(e){return []} }
    function saveAppointments(a){ localStorage.setItem(KEY, JSON.stringify(a)) }
    function escape(s){ return String(s||'').replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])) }
    function formatDate(d){ if(!d) return ''; const p=d.split('-'); return p[1]+'/'+p[2]+'/'+p[0] }

    function render(){
      let items = getAppointments();
      
      // Sort: Newest dates first
      items.sort((a,b)=> new Date(b.date+' '+b.time) - new Date(a.date+' '+a.time));

      listEl.innerHTML = '';
      
      if(items.length === 0){
        emptyMsg.style.display = 'block';
        return;
      } else {
        emptyMsg.style.display = 'none';
      }

      items.forEach(item=>{
        const card = document.createElement('div');
        card.className = 'apt-card';
        
        // Simple status logic based on date
        const apptDate = new Date(item.date + ' ' + item.time);
        const isPast = apptDate < new Date();
        const statusLabel = isPast ? 'Completed' : 'Upcoming';
        const statusStyle = isPast ? 'background:#eee;color:#555' : 'background:#e6f7e6;color:#2d7a31';

        card.innerHTML = `
          <div class="apt-header">
            <div>
              <div class="apt-service">${escape(item.service)}</div>
              <div class="apt-details">
                <span>${escape(item.name)} (${escape(item.studentId)})</span>
                <span>${escape(item.email)}</span>
              </div>
            </div>
            <div style="text-align:right">
              <div class="apt-date">${formatDate(item.date)} at ${item.time}</div>
              <div style="margin-top:6px"><span class="status-badge" style="${statusStyle}">${statusLabel}</span></div>
            </div>
          </div>
          ${item.notes ? `<div class="apt-notes"><strong>Notes:</strong> ${escape(item.notes)}</div>` : ''}
          <div style="margin-top:10px; display:flex; justify-content:flex-end; gap:8px">
             <button data-action="delete" data-id="${item.id}" class="btn-outline" style="border-color:#eee; color:#666; font-size:12px; padding:6px 10px;">Cancel / Delete</button>
          </div>
        `;
        listEl.appendChild(card);
      });
    }

    // Delete handling
    listEl.addEventListener('click', function(e){
      const btn = e.target.closest('button');
      if(!btn) return;
      const id = btn.getAttribute('data-id');
      const action = btn.getAttribute('data-action');
      
      if(action === 'delete'){
        if(!confirm('Are you sure you want to remove this record?')) return;
        let items = getAppointments();
        items = items.filter(x => x.id !== id);
        saveAppointments(items);
        render();
      }
    });

    render();
  })();
</script>
  </body>
</html>